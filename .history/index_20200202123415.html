<!DOCTYPE html>
<html lang="en">
  <head>
    <title>大冰人生规划管理系统</title><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="./js/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>
    <script src="./js/FileSaver.js"></script>
    <script src="./js/utils/UrlUtil.js"></script>
    <link rel="stylesheet" href="./css/common.css">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  </head>
  <body>
    <div id="app">
        <el-container>
            <el-header>
              <el-menu
                class="el-menu-demo"
                mode="horizontal"
                background-color="#545c64"
                text-color="#fff"
                active-text-color="#ffd04b">
                <el-menu-item index="1">主页</el-menu-item>
                <el-menu-item index="2">日程管理</el-menu-item>
                <el-submenu index="3">
                    <template slot="title">帮助</template>
                    <el-menu-item index="3-1">设置</el-menu-item>
                    <el-menu-item index="3-2">关于我们</el-menu-item>
                    <el-menu-item index="3-3">常见问题</el-menu-item>
                  </el-submenu>
              </el-menu>
            </el-header>
            <el-main>
                <h1>日程管理</h1>
                <el-calendar>
                  <!-- 这里使用的是 2.5 slot 语法，对于新项目请使用 2.6 slot 语法-->
                  <template
                    slot="dateCell"
                    slot-scope="{date, data}">
                    <p :class="data.isSelected ? 'is-selected' : ''">
                      {{ data.day.split('-')[2]}} {{ data.isSelected ? '✔️' : ''}}
                    </p>
                  </template>
                </el-calendar>
                <el-button @click="downloadTextFile()">测试保存文件</el-button>
            </el-main>
          </el-container>
    </div>

    <script>
        var vm = new Vue({
          el:"#app",
          
          data () {
            return {
              clientId: 'aa095e4edcac79b02a6e',
              clientSecret: 'b7107a6b6c65a1ae13ab2494754b4f17f2343c05',
              github_token: 'b018768a02441354f0340f068cea8fef984e5def'
            }
          },
          created () {
            let code = Urlutil.getUrlKey("code", "https://iceacmen.github.io/?code=1c9cf47fb0eeaf688fe2");
            if (_.isEmpty(code)) {
              //跳转到github授权页面
              // https://github.com/login/oauth/authorize?client_id=aa095e4edcac79b02a6e
              window.open("https://github.com/login/oauth/authorize?client_id=" + this.clientId + 'redirect_uri=file:///F:/ICE/VScode/iceAcmen.github.io/index.html');  
            }
            console.log("code : " + code)
            fetch('https://api.github.com/user', {
              method: 'GET',
              headers:{
                'Accept': 'application/json',
                'Authorization': 'token ' + this.github_token
              }
            }).then(res=>{
              debugger
              if (!res.ok) {
                res.text().then(json=>{
                  console.log("获取用户信息失败", json)  
                })
                return;
              }
              res.json().then(json=>{
                console.log("获取token成功", json)
              })
              
            }).catch(err=>{
              debugger
              console.log("获取token失败", err)
            });
            // fetch('https://github.com/login/oauth/access_token?client_id=aa095e4edcac79b02a6e&client_secret=b7107a6b6c65a1ae13ab2494754b4f17f2343c05&code=559d4bd5fbc342fd7c08', {
            //   method: 'GET',
            //   mode: 'no-cors',
            //   headers:{
            //     'Accept': 'application/json'
            //   }
            // }).then(res=>{
            //   debugger
            //   if (!res.ok) {
            //     res.text().then(json=>{
            //       console.log("获取token失败", json)  
            //     })
            //     return;
            //   }
            //   console.log("获取token成功", res)
            // }).catch(err=>{
            //   debugger
            //   console.log("获取token失败", err)
            // })
          },
          methods: {
            aaa(){
              alert("bbb");
            },
            /**
             * 下载文件
             */
            downloadTextFile(mobileCode) {
              var file = new File([JSON.stringify({ice:"123"})], "手机号.json", { type: "text/plain;charset=utf-8" });
              saveAs(file);
            }
          }
        })
      </script>

  </body>
</html>
